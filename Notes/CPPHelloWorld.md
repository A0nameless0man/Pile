# C++ 开发入门

这篇文章的目的在于，教会对电脑有初步了解的同学用 C++ 写出一个简单的程序。

<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [概述](#概述)
- [基本概念](#基本概念)
  - [软件](#软件)
  - [命令行](#命令行)
  - [环境变量](#环境变量)
  - [工具链](#工具链)
- [CPP开发](#cpp开发)
  - [Windows下的开发工具安装](#windows下的开发工具安装)
    - [怎么设置环境变量](#怎么设置环境变量)
    - [通过 `msys2` 安装 `GNU` 软件环境](#通过-msys2-安装-gnu-软件环境)
  - [编写并编译第一份源代码](#编写并编译第一份源代码)

<!-- /code_chunk_output -->

## 概述

电脑运行的程序本质上是一个或一些包含了大量指令与数据的文件，它向电脑描述了程序员的意图。我们当然可以手动的编写这些指令，但我们也可以通过一些其它的方式间接地向电脑描述我们的意图。

C++ 语言及其工具链就是一种方式。

本文假设读者对电脑操作有基本的了解。

如果在本文中见到不认识或不了解的概念或事物，请自行 [`百度`](http://www.baidu.com) 或 [`Google`](http://www.google.com)

如果有的部分您已经熟悉，可以直接跳过。

## 基本概念

在开始教程之前，我希望确保各位对一下的名称有基本的了解。

### 软件

是保存了特定指令和数据的文件。可以被运行。

有一部分的软件具有图形界面，可以之间响应用户的鼠标点击等事件。

有一些软件只能通过 `标准输入输出` 来进行交互，这意味着你可以向他输入字符串，软件也会以字符串回应。注意，键盘上的回车，ctrl，方向等键在这种模式下被认为是特定的字符或字符的组合。

目前多数操作系统允许在启动程序时附加参数，通常我们通过命令行程序来为我们要运行的程序附加参数。

### 命令行

首先**命令行也是一种软件**

它读取用户的输入，调用相应的程序来做出响应。

也可以将一个程序的输出传给其它程序做输入。

可以看作是其它所有程序的一层代理，转发具有 `标准输入输出` 的程序的输入输出。

或者一种原始的 UI (用户界面)

有时也被称作终端。

以下是两种常见的 命令行 ：

1. bash

    - 历史悠久，使用广泛。

    - 程序的输入输出都是 **字符串**。

    - 常见于类 unix 系统

2. powershell

   - 新生事物，功能强大，但是支持者较少。

   - 程序输出的是对象，有属性和方法。

   - 常见于windows

>由于 类 unix 系统中命令行非常显眼，这里介绍一下 Windows 下启动 `PowerShell` 的方法。
>
>在开始菜单中找到 `Windows PowerShell` ,双击里面的 `Windows PowerShell` 即可，默认情况下是个蓝色背景的窗口。
>
>也可以直接 `win` + `r` 然后输入 `PowerShell` 点击运行。

在命令行中，要启动一个程序只需要输入对应的文件名(有时候需要完整的路径),然后按下回车表示输入完毕，你要运行的程序就会开始运行。

比如说，可以输入 `ls` 这个程序会列出 `当前目录` 下的所有文件和文件夹(隐藏文件除外)

不同的操作系统下，启动命令行后的当前目录是不同的。一般用 `.` 或 `./` 代表

通过命令行给程序附带参数也非常简单，只要在程序名的后面，用空格分隔你的参数即可，多个参数之间的分隔符也是空格。对于多数程序，它的参数是有顺序的，具体请查阅各个程序的文档。

比如说，`man` 这个程序接受一个参数表示待查询的程序，`man cd` 就是查询 `cd` 这个程序的文档。

### 环境变量

一种在整个系统中共享信息和设置的方法。

由名字和值组成。

名字是不可以重复的忽略大小写的字符串(只能包含英文字母，数字和下划线)。

值则是字符串。

比如：

- 名字为 `path` 的环境变量

  - 这个变量可以被看做是一个 **目录** 的列表（各项之间用字符 `;` 分隔）。
  - 这个变量指明了当用户在命令行下输入命令时，系统应当到哪里去找这个命令的程序文件。
  - 如果没有配置的话，虽然这个软件已经在电脑上，但是系统不知道到哪里找程序文件，所以还是会找不到命令，就不得不输入完整的，带路径的文件名。

### 工具链

工具链指在进行一项特定活动时搭配使用的一组软件，其中每个软件都具有特定的功能，配合使用来达成最终的效果。

在编写软件这一特定的活动中，通常包含如下类型的软件。

- 编辑器

  用于编辑源代码文件

- 编译器

  用于将编写的源代码文件转换为程序文件，即计算机硬件指令。这一过程又称编译。

- 调试器

  用于通过某些方法，发现程序中的错误或运行不正确的原因。

由于这份文档只是入门内容，我们将使用 记事本 作为编辑器，并且不会涉及调试器的内容。

## CPP开发

之前描述了 C++ 语言及其工具链是一种向电脑描述我们的指令的方式。这里稍微介绍一下它的过程。

1. 将指令按照一定的格式(即C++语法规范)写在一个文本文件里(word的文件带有格式数据，不是文本文件。记事本的那种是的)。这种文件即被称作源代码，符合C++语法规范的就是C++源代码。

2. 使用实现了C++规范的编译器将源代码编译为机器代码。这一步里面又有可能包含更多中间步骤和中间类型的文件。这里不详细展开。

3. 运行程序。

编辑器的选择是个比较自由的事情，市面上的选择很多。

实现了C++规范的编译器就比较少了，其中优秀的更少。一般来说，推荐使用 `GCC` 或 `clang` 编译器。

### Windows下的开发工具安装

由于不同发行版的 Linux 具有其独特的 包管理系统 。这里简单介绍一下如何在 Windows 下安装本文需要的软件。

由于历史原因， Windows 下长期缺乏统一的“软件商店”。

Windows 的软件安装逻辑又与 Unix 系有许多差别，虽然多数软件有针对 Windows 的发行版，但有时需要一些调整以正常工作。

#### 怎么设置环境变量

Unix 系统下，多数软件安装在 `/usr/bin` 下，而这个目录默认是在 `PATH` 里的，所以许多软件不会自动将自己的可执行文件所在的目录加入 `PATH` ，从而无法正常调用。

不过我们可以自己完成这缺失的一步。

>1. 右击 `我的电脑` / `此电脑`
>
>    - 桌面上没有的话，文件资源管理器里的也可以。
>
>1. 选择 `属性`
>
>1. 选择左侧列表中的 `高级系统设置`
>
>1. 选择 `高级` 页
>
>1. 点击下面 `环境变量` 的按钮。
>
>1. 可以选择编辑系统变量或用户变量，区别是系统变量是全局的，用户变量只有自>己看得见。
>
>1. 找到并选中 `希望修改的环境变量` ，大小写无所谓的。
>
>1. 点击 `编辑`，然后 `新建`
>
> 1. 没有 `新建` 按钮，可以直接编辑 `值` ，和已有内容用 `;` 分隔。
>
>1. 加入你需要的路径

当我们谈到要添加 `PATH` 或者 `路径` 时，还有一个要素是被添加的路径。

这个一般要找到刚安装的可执行文件的所在地。比如说直接全盘搜索。

如果你使用特定的方式如 `msys` 来管理 Windows下的 Unix 类软件的话，会有一个专门的目录相当于 `/usr/bin`，只要将其加入 `PATH` 中，通过 `msys2` 获取的软件就不需要再另外添加 `PATH` 了。

#### 通过 `msys2` 安装 `GNU` 软件环境

简单来说，先下载 `msys2` 的安装包，然后直接安装。

由于神秘的原因，有时候会卡在 66% 进度，任务管理器杀掉安装进程重开即可。

安装完毕后，如果选择立即打开，会打开 `msys2` 自带的命令行。这个命令行里的环境变量和系统里的是不一样的。为了避免日后出问题。我们改用 `PowerShell` 作为我们使用的命令行。

在 `msys2` 中，相当于 `/usr/bin` 的目录就是 `安装目录/usr/bin` ,默认情况下是 `C:/msys64/usr/bin`。将这个目录加入 `PATH` ，这样子， `PowerShell` 就能够找到 `msys2` 中的软件了。

`msys2` 带了一套包管理系统叫 `pacman`.

基本上，只需要了解如下基础命令：

```sh
pacman -Syu #检查更新并更新
#如果pacman被更新了，请在看到提示后遵循提示强行终止pacman（ ctrl + C ）并再次执行如上命令

pacman -S *** #安装软件或软件包，比如基础开发环境包 "base-devel"
```

一般来说，建议安装 `base-devel` ，`make` , `ssh`, `gcc`。这几个，其它的软件可以根据需求选择。

其中，本文章必须的 `g++` 就包含在 `gcc` 这个包中。

使用这个命令来安装它：

```sh
pacman -S gcc
```

另外，既然是包管理系统，那就不可避免的有源的问题，就是从哪里下载软件。由于 `msys2` 的默认源在国外，访问速度极其缓慢，建议更换清华大学提供的源，方法见[清华的说明](https://mirror.tuna.tsinghua.edu.cn/help/msys2/)。

不过我发现最新版(20200720)中，清华源已经在默认的列表里了，只要调整一下顺序即可。

如果在下载过程中网络波动，导致添加在头部的清华源失败，`pacman` 会回退到默认源。这时最好直接中断（ `ctrl` + `C` ）然后重开。

如果由于下载速度慢，经常失败，可以添加参数 `--disable-download-timeout` 来禁用下载超时。

安装完毕后就可以继续进行了。

### 编写并编译第一份源代码

这里不会详细描述 C++ 的语法，但是会讲一些初步的概念。

通常一个人在接触一门编程语言后的第一份代码是向 `标准输出` 中输出一些什么。这里的程序也不例外。

这是一份示例代码，可以将其复制进一个文本文件(Windows 下即为 txt 文件)中，然后改名为 `src.cpp` (Windows 下要注意后缀名)。在相同目录下打开一个命令行(Windows 下可以按住 `shift` 在文件管理器窗口的空白处右击，选择 `在此处打开PowerShell`)，执行 `g++ ./src.cpp -o hello.exe`。就会编译成功了。

```cpp
#include<iostream>
int main(void) {
  std::cout <<"Hello World"<<std::endl;
  return 0;
}
```

可以看到，这个程序在其定义的 `main` 函数中，使用流操纵符 `<<` 向 `标准输出流` 也就是 `std::cout` 中输出了一个字符串和 `std::endl`。

在 C++ 中，任何要用到的对象和函数都需要事先声明。

它的第一行指定 `include` 一个文件名为 `iostream` 的文件。`std::cout` 和 `std::endl` 的声明就在这个文件里。

但是，在各位的桌面或者文档文件夹中是看不到这个文件的。但编译器却成功编译了。这说明 `iostream` 这个文件一定在电脑上某处。

一般来说，编译器会在 `INCLUDE` 这个环境变量中查找。但是由于这些文件是随 `gcc` 一起安装的，所以 `gcc` 和 `g++` 这两个编译器可以自己找到这些文件。但如果想让编译器使用其它的文件，就需要设置 `INCLUDE` 环境变量。

然后回过头来看刚才编译时执行的命令 `g++ ./src.cpp -o hello.exe` 。

可以看到，根据命令行的参数原则，给 `g++` 这个程序传递了三个参数：`./src.cpp` , `-o` 和 `hello.exe`。

其中，`-o` 说明其后的那一个参数是指定编译器输出其编译结果的文件名

`./src.cpp` 没有被修饰，一般会被解读为源文件的名字。

具体的参数选项还有很多，可以参考编译器的手册。
