# 错觉题解

## 基本原理

首先进行搜索，找出所有黑色的连通块，也就是题目中要求的图案。

然后，对于每个黑色的连通块，把所有和它不在一个图案中的像素视为白色，再次计算连通块数量。有4个就是找到了（外侧，自身，两个孔）

## 边界条件处理

但是要注意，有时候，由于图像边界的问题，会导致外侧不连通而出现误判。解决这个问题的方法非常简单，在输入的图像外圈填充一层白色像素即可。

## 时间复杂度的控制

如果完全按照上方的算法进行，令 $n$ 为像素总数，每次寻找联通块的复杂度是 $O(n)$ 的，最坏情况下，会有 $\frac{n}{2}$ 的图案，这意味着第二轮需要进行这么多次的连通块计算。也就是说，总的时间复杂度会接近 $O(n^2)$ 。由于题目给出的数据范围，这明显是不可接受的。

但是，考虑一下，如果图案很多，意味着每个图案会比较小。这样子的话，第二轮的每次连通块计算应当可以节约下相当的时间。

也就是说，通过对第二轮连通块搜索的范围进行一定的约束，可以极大的减小第二轮搜索的总复杂度。

这个约束必然涉及到以某种方式保存每个图案的 “轮廓” 。考虑最简单的方法，保存一下每个图案的4至。也就是包裹这个图案的最小的长方形的信息。

考虑这种算法的时间复杂度。假设对于某个图案 $i$ ，其轮廓的面积为 $m_i$ 。不难看出，这个图案至少包含 $\sqrt{m_i}$ 个像素并且必然有 $m_i \leq n$ 。

那么，总的时间复杂度就是 $O(\sum_{i}{m_i})$ 。通过一些观察，可以猜测，有 $\sum_{i}{m_i} \leq n \cdot \sqrt(n)$ 。

但是我们还需要进行证明。已知的约束有两个， $\forall m_i , m_i \leq n$ 和 $\sum_{i}{\sqrt{m_i}} \leq n$ 。

首先，我们知道，$\frac{\text{d}x}{\text{d}\sqrt{x}}$在 $[1,+\infty)$ 上恒为正。也就是说，对于任意的一组 $m$ 满足 $\sum_{i}{\sqrt{m_i}} < n$ ，总是可以通过增大任意一个 $m_i$ 来使得 $\sum_{i}{m_i}$ 增加。

换句话说，当 $\sum_{i}{m_i}$ 取最大值时，必有 $\sum_{i}{\sqrt{m_i}} = n$ 。

那么，问题变成了，将 $n$ 分成若干份，在每一份的平方都不大于 $n$ 的情况下，使得总的平方和最大。

假设分成 $k$ 份。

根据柯西不等式： $a^2 + b^2 \leq 2\cdot (\frac{a+b}{2})^2$ 。因此，任何的不是平均分配的分解方法总是可以通过选取两个不等的分量并将其转化为它们的平均值来使的总平方和更大。

那么，最优的分配方案必然是平均分配。

在平均分配的策略下，总平方和明显是 $k$ 的函数。即 $f(k) = k\cdot(\frac{n}{k})^2 = \frac{n^2}{k}$

这是关于 $k$ 的减函数。又由于有  $\forall m_i , m_i \leq n$ 即 $(\frac{n}{k})^2 \leq n$ 的限制。$k$ 的最优取值为 $\sqrt{n}$ 。此时，总的平方和也就是 $\sum_{i}{m_i}$ 为 $n \cdot \sqrt(n)$ 。这样子，我们成功证明了复杂度的上界。

## 总结

解出题目包括两轮联通块搜索，广搜与深搜均可，但是当心爆栈。

第一轮搜索的过程中要保存一下每一块图案的四至。第二轮搜索的时候通过记录的信息来约束搜索的范围即可。如果有图案在第二轮搜出4个连通块，即可输出。
